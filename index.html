<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡∏Å‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ - ‡∏ö‡∏à‡∏Å. ‡πÅ‡∏´‡∏•‡∏°‡∏ó‡∏≠‡∏á‡∏Å‡∏¥‡∏à</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        /* --- START: NEW GRADIENT CSS --- */
        :root {
            --dark-green: #004d40; --dark-green-shadow: #002d24;
            --brown: #5d4037; --brown-shadow: #3e2723;
            --yellow: #ffc107; --yellow-shadow: #b38600;
            --gray: #757575; --gray-shadow: #424242;
            --light-gray: #f7f9fc; --text-color: #212529;
            --border-color: #dee2e6; --card-bg: #ffffff;
            --card-shadow: 0 4px 25px rgba(0, 0, 0, 0.05);
            --danger-bg: #ffebee; --danger-text: #b71c1c; --danger-border: #ef9a9a;
            
            /* PDF Colors with Gradients */
            --pdf-primary: #004d40;
            --pdf-primary-light: #00796b; /* Lighter green for gradient */
            --pdf-accent: #DAA520;
            --pdf-accent-light: #f0c040; /* Lighter gold for gradient */
            --pdf-text-dark: #333333;
            --pdf-text-light: #666666;
            --pdf-bg-light: #f8f9fa;
        }
        body {
            font-family: 'Sarabun', sans-serif; background-color: var(--light-gray);
            color: var(--text-color); margin: 0; padding: 0; line-height: 1.7;
            -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
        }
        .page-wrapper { max-width: 960px; margin: 20px auto; padding: 15px; }
        .card {
            background-color: var(--card-bg); border-radius: 12px;
            box-shadow: var(--card-shadow); margin-bottom: 25px; padding: 25px;
        }
        .card-header { text-align: center; }
        .card-header img { max-width: 120px; margin-bottom: 15px; }
        .card-header h1 { font-size: 2rem; font-weight: 700; margin: 0 0 5px 0; color: var(--dark-green); }
        .card-header p { color: #6c757d; font-size: 1.1rem; margin: 0; }
        .company-details {
            border-top: 1px solid var(--border-color); margin-top: 20px;
            padding-top: 20px; font-size: 1rem; color: #495057;
        }
        .btn {
            display: inline-block; font-family: 'Sarabun', sans-serif;
            font-weight: 700; font-size: 1.1rem; color: white;
            text-align: center; vertical-align: middle; cursor: pointer;
            border: none; padding: 12px 28px; border-radius: 8px;
            transition: transform 0.1s ease, box-shadow 0.1s ease;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.2);
        }
        .btn:active { transform: translateY(2px); }
        .btn:disabled { background-color: #aaa; cursor: not-allowed; box-shadow: 0 4px 0 0 #777; }
        .btn-green { background-color: var(--dark-green); box-shadow: 0 4px 0 0 var(--dark-green-shadow); }
        .btn-brown { background-color: var(--brown); box-shadow: 0 4px 0 0 var(--brown-shadow); }
        .btn-gray { background-color: var(--gray); box-shadow: 0 4px 0 0 var(--gray-shadow); }
        .btn-yellow { background-color: var(--yellow); color: var(--brown); box-shadow: 0 4px 0 0 var(--yellow-shadow); text-shadow: none; }
        .action-buttons { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-top: 20px; }
        #form-container { display: none; }
        #form-container h2 { text-align: center; font-size: 1.8rem; margin-bottom: 25px; }
        .form-section-title {
            font-size: 1.3rem; font-weight: 700; color: var(--brown);
            margin: 0 0 20px 0; padding-bottom: 10px; border-bottom: 2px solid var(--border-color);
        }
        .form-grid { display: grid; grid-template-columns: 150px 1fr; gap: 20px; align-items: center; }
        .form-grid label { font-weight: 500; text-align: right; color: #495057; }
        input[type="text"], input[type="number"], select, textarea {
            width: 100%; padding: 10px 12px; border: 1px solid var(--border-color);
            border-radius: 6px; box-sizing: border-box; font-family: 'Sarabun', sans-serif;
            font-size: 1rem;
        }
        textarea { resize: vertical; min-height: 80px; }
        .summary-section { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; }
        .totals-display table { width: 100%; }
        .totals-display td { padding: 8px 0; }
        .totals-display td:last-child { text-align: right; font-weight: 700; }
        .grand-total td { font-size: 1.5rem; color: var(--dark-green); border-top: 2px solid var(--dark-green); padding-top: 10px; }
        #form-validation-error {
            display: none; background-color: var(--danger-bg); color: var(--danger-text); border: 1px solid var(--danger-border);
            padding: 12px 15px; border-radius: 8px; text-align: center; margin-top: 20px; font-weight: 500;
        }
        @media (max-width: 768px) {
            .page-wrapper { padding: 10px; }
            .form-grid { grid-template-columns: 1fr; }
            .form-grid label { text-align: left; }
            .summary-section, .final-actions { grid-template-columns: 1fr; }
        }
        .item-card { background: #f9f9f9; border: 1px solid #e0e0e0; border-radius: 8px; margin-bottom: 16px; padding: 16px; }
        .item-card-row { display: flex; flex-wrap: wrap; align-items: center; gap: 10px; margin-bottom: 10px; }
        .item-card-row label { min-width: 80px; font-weight: 500; color: #6c757d; }
        .item-card-row input, .item-card-row select { flex: 1 1 100px; padding: 8px 10px; border: 1px solid #dee2e6; border-radius: 6px; font-size: 1em; }
        .item-card-row .item-total { font-weight: 700; color: var(--dark-green); font-size: 1.1em; }
        .item-card-row .delete-btn { background: #dc3545; color: #fff; border: none; border-radius: 6px; padding: 8px 16px; cursor: pointer; margin-left: auto; }
        .item-card-total-row { justify-content: flex-end; }
        @media (max-width: 600px) {
            .item-card-row { flex-direction: column; align-items: stretch; }
        }

        /* --- PDF DESIGN --- */
        #pdf-template {
            position: absolute; left: -9999px; top: 0;
            width: 210mm; height: 297mm;
            background-color: white; color: var(--pdf-text-dark);
            font-family: 'Sarabun', sans-serif; font-size: 10pt;
            display: flex; flex-direction: column;
        }

        .pdf-header-new {
            background: linear-gradient(110deg, var(--pdf-primary) 0%, var(--pdf-primary-light) 100%);
            color: white;
            padding: 8mm 15mm;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }
        .pdf-header-new .pdf-logo {
            width: 25mm; height: 25mm;
            background-color: white;
            border-radius: 50%;
            padding: 2mm;
            object-fit: contain;
        }
        .pdf-header-new .pdf-company-info { text-align: right; }
        .pdf-header-new .pdf-company-info h2 { margin: 0; font-size: 1.8em; font-weight: 700; }
        .pdf-header-new .pdf-company-info p { margin: 1mm 0 0 0; font-size: 0.9em; opacity: 0.9; }

        .pdf-main-new {
            padding: 10mm 15mm;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .pdf-title-new {
            text-align: center;
            font-size: 2.2em;
            font-weight: 700;
            color: var(--pdf-primary);
            margin: 0 0 8mm 0;
            padding-bottom: 4mm;
            position: relative;
            border-bottom: none; /* Remove solid border */
        }
        .pdf-title-new::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--pdf-accent) 0%, var(--pdf-accent-light) 100%);
        }

        .pdf-info-grid-new {
            display: grid;
            grid-template-columns: 1.2fr 1fr;
            gap: 10mm;
            margin-bottom: 10mm;
            font-size: 0.95em;
        }
        .pdf-info-grid-new .pdf-info-box strong {
            display: block; font-size: 1.1em; font-weight: 600;
            color: var(--pdf-primary); margin-bottom: 2mm;
        }
        .pdf-info-grid-new .pdf-info-box p { margin: 0 0 1.5mm 0; color: var(--pdf-text-light); }

        .pdf-table-new {
            width: 100%; border-collapse: collapse; font-size: 0.9em;
        }
        .pdf-table-new thead tr {
            background-color: var(--pdf-bg-light); color: var(--pdf-primary);
            text-align: left; border-bottom: 2px solid var(--pdf-primary);
        }
        .pdf-table-new th { padding: 3mm 4mm; font-weight: 600; }
        .pdf-table-new td { padding: 3mm 4mm; border-bottom: 1px solid #eee; }
        .pdf-table-new .text-right { text-align: right; }

        .pdf-summary-new {
            display: flex; justify-content: flex-end; margin-top: 5mm;
        }
        .pdf-summary-new table { width: 50%; }
        .pdf-summary-new td { padding: 2mm 4mm; }
        .pdf-summary-new .grand-total td {
            background: linear-gradient(110deg, var(--pdf-primary) 0%, var(--pdf-primary-light) 100%);
            color: white;
            font-size: 1.3em;
            font-weight: bold;
            padding-top: 3mm;
            border-top: none;
            border-radius: 4px;
        }

        .pdf-footer-new {
            margin-top: auto; padding-top: 8mm;
            display: grid; grid-template-columns: 1fr 1fr 1fr;
            gap: 10mm; align-items: flex-start;
        }
        .pdf-footer-new .pdf-payment-info strong { font-size: 1.1em; color: var(--pdf-primary); }
        .pdf-footer-new .pdf-qr-code {
            width: 35mm; height: 35mm; border: 1px solid #ddd;
            background-size: contain; background-position: center; background-repeat: no-repeat;
            margin-top: 2mm; padding: 1.5mm; background-color: white; border-radius: 4px;
        }
        .pdf-footer-new .pdf-signature-box { text-align: center; padding-top: 15mm; }
        .pdf-footer-new .signature-line {
            border-bottom: 1px solid var(--pdf-text-dark); margin: 0 5mm 2mm 5mm;
        }
        /* --- END OF CSS --- */
    </style>
</head>
<body>
    <div class="page-wrapper">
        <div id="initial-page">
            <div class="card">
                <div class="card-header">
                    <img id="main-logo-img" src="data:image/png;base64,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" alt="Company Logo">
                    <h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡∏Å‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</h1>
                    <p>‡∏ö‡∏à‡∏Å. ‡πÅ‡∏´‡∏•‡∏°‡∏ó‡∏≠‡∏á‡∏Å‡∏¥‡∏à‡πÄ‡∏Å‡∏©‡∏ï‡∏£</p>
                </div>
                <div class="company-details">
                    <p><strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> 298 ‡∏´‡∏°‡∏π‡πà 2  ‡∏ï.‡∏û‡∏£‡∏∏‡πÄ‡∏ï‡∏µ‡∏¢‡∏ß ‡∏≠.‡πÄ‡∏Ç‡∏≤‡∏û‡∏ô‡∏° ‡∏à.‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà 81140</p>
                    <p><strong>‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ:</strong> 0815565002748</p>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-green">‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤</button>
                    <button class="btn btn-green">‡∏ö‡∏¥‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</button>
                </div>
            </div>
        </div>
        <div id="form-container">
            <h2 id="doc-title"></h2>
            <div class="card">
                <h3 class="form-section-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h3>
                <div class="form-grid">
                    <label for="document-number">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£:</label>
                    <input type="text" id="document-number" readonly style="background:#f3f3f3; color:#888;">
                    <label for="customer-name">‡∏ä‡∏∑‡πà‡∏≠/‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó:</label>
                    <input type="text" id="customer-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤">
                    <label for="customer-address">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</label>
                    <textarea id="customer-address" rows="3" placeholder="‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡∏Å‡πÉ‡∏ö‡∏Å‡∏≥‡∏Å‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏µ"></textarea>
                    <label for="customer-tax-id">‡πÄ‡∏•‡∏Ç‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ:</label>
                    <input type="text" id="customer-tax-id" placeholder="13 ‡∏´‡∏•‡∏±‡∏Å (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)">
                </div>
            </div>
            <div class="card">
                <h3 class="form-section-title">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</h3>
                <div id="items-list"></div>
                <button id="add-item-btn" class="btn btn-yellow" style="margin-top: 20px; width:100%;">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
            </div>
            <div class="summary-section">
                <div class="card totals-display">
                    <h3 class="form-section-title">‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î</h3>
                    <table>
                        <tbody>
                            <tr><td>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°</td><td id="summary-subtotal">0.00</td></tr>
                            <tr><td>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</td><td id="summary-item-count">0</td></tr>
                            <tr class="grand-total"><td>‡∏¢‡∏≠‡∏î‡∏ä‡∏≥‡∏£‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô</td><td id="summary-grand-total">0.00</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card">
                <h3 class="form-section-title">QR Code PromptPay</h3>
                <p style="color:#b71c1c;font-size:0.98em;margin:0 0 10px 0;">* ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î QR Code ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á PDF</p>
                <div class="form-grid">
                    <label for="qr-code-image">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û QR Code:</label>
                    <input type="file" id="qr-code-image" accept="image/*" style="padding: 8px;">
                </div>
                <div id="qr-preview" style="margin-top: 15px; text-align: center; display: none;">
                    <div id="qr-preview-img" style="width: 250px; height: 250px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); border: 3px solid #e0e0e0; background-color: white; margin: 0 auto; background-size: contain; background-position: center; background-repeat: no-repeat;"></div>
                    <p style="margin-top: 12px; font-size: 1em; color: #666; font-weight: 500;">QR Code ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</p>
                </div>
            </div>
            <div class="final-actions">
                <button id="back-to-main-btn" class="btn btn-gray">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
                <button id="save-pdf-btn" class="btn btn-brown">‡∏™‡∏£‡πâ‡∏≤‡∏á PDF ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á Telegram</button>
            </div>
            <div id="form-validation-error"></div>
        </div>
    </div>
    
    <!-- START: NEW PDF TEMPLATE HTML -->
    <div id="pdf-template">
        <header class="pdf-header-new">
            <img id="pdf-logo-img" class="pdf-logo" src="" alt="Logo">
            <div class="pdf-company-info">
                <h2>‡∏ö‡∏à‡∏Å. ‡πÅ‡∏´‡∏•‡∏°‡∏ó‡∏≠‡∏á‡∏Å‡∏¥‡∏à‡πÄ‡∏Å‡∏©‡∏ï‡∏£</h2>
                <p>298 ‡∏´‡∏°‡∏π‡πà 2 ‡∏ï.‡∏û‡∏£‡∏∏‡πÄ‡∏ï‡∏µ‡∏¢‡∏ß ‡∏≠.‡πÄ‡∏Ç‡∏≤‡∏û‡∏ô‡∏° ‡∏à.‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà 81140 | ‡πÇ‡∏ó‡∏£: 062-2924456</p>
                <p>‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ: 0815565002748</p>
            </div>
        </header>
        <main class="pdf-main-new">
            <h1 class="pdf-title-new" id="pdf-doc-title-render"></h1>

            <section class="pdf-info-grid-new">
                <div class="pdf-info-box">
                    <strong>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</strong>
                    <p id="pdf-customer-name"></p>
                    <p id="pdf-customer-address"></p>
                    <p>‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ: <span id="pdf-customer-tax-id"></span></p>
                </div>
                <div class="pdf-info-box">
                    <strong>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</strong>
                    <p>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£: <span id="pdf-document-number"></span></p>
                    <p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: <span id="pdf-doc-date"></span></p>
                </div>
            </section>

            <table class="pdf-table-new">
                <thead>
                    <tr>
                        <th style="width: 45%;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                        <th class="text-right" style="width: 10%;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                        <th style="width: 10%;">‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
                        <th class="text-right" style="width: 12%;">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
                        <th class="text-right" style="width: 10%;">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</th>
                        <th class="text-right" style="width: 13%;">‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
                    </tr>
                </thead>
                <tbody id="pdf-items-tbody">
                    <!-- Items will be injected by JS -->
                </tbody>
            </table>
            
            <section class="pdf-summary-new">
                <table>
                    <tbody id="pdf-summary-tfoot">
                        <!-- Summary will be injected by JS -->
                    </tbody>
                </table>
            </section>

            <footer class="pdf-footer-new">
                <div class="pdf-payment-info">
                    <strong>‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</strong>
                    <div id="pdf-qr-code-img" class="pdf-qr-code"></div>
                </div>
                <div class="pdf-signature-box">
                    <div class="signature-line"></div>
                    <p>(............................................)</p>
                    <p>‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>
                </div>
                <div class="pdf-signature-box">
                    <div class="signature-line"></div>
                    <p>(............................................)</p>
                    <p>‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</p>
                </div>
            </footer>
        </main>
    </div>
    <!-- END: NEW PDF TEMPLATE HTML -->

<script>
(function() {
    'use strict';
    const { jsPDF } = window.jspdf;
    let docType = '';
    let grandTotalNumber = 0;

    // --- üî¥ CRITICAL: Replace these placeholder values with your own Telegram credentials. ---
const TELEGRAM_BOT_TOKEN = '8168894246:AAEKgqX0VLKp0LrqTB1HigIK13l8bhkDIjM';
const TELEGRAM_CHAT_ID = '-1002778171481';

    const initialPage = document.getElementById('initial-page');
    const formContainer = document.getElementById('form-container');
    const docTitle = document.getElementById('doc-title');
    const addItemBtn = document.getElementById('add-item-btn');
    const itemsList = document.getElementById('items-list');
    const savePdfBtn = document.getElementById('save-pdf-btn');
    const backToMainBtn = document.getElementById('back-to-main-btn');
    const qrCodeImageInput = document.getElementById('qr-code-image');
    const qrPreview = document.getElementById('qr-preview');
    const qrPreviewImg = document.getElementById('qr-preview-img');
    const validationError = document.getElementById('form-validation-error');

    let selectedQRImage = null;
    let selectedLogo = null;

    function loadEmbeddedLogo() {
        const mainLogoImg = document.getElementById('main-logo-img');
        if (mainLogoImg && mainLogoImg.src.startsWith('data:image')) {
            selectedLogo = mainLogoImg.src;
            console.log('Embedded company logo loaded successfully.');
        } else {
            selectedLogo = null;
            console.error("Could not find embedded logo. PDFs will not have a logo.");
        }
    }
    
    document.addEventListener('DOMContentLoaded', () => {
        loadEmbeddedLogo();
        document.querySelectorAll('.action-buttons .btn').forEach(button => {
            button.addEventListener('click', () => showForm(button.textContent.trim()));
        });
        addItemBtn.addEventListener('click', addItemCard);
        itemsList.addEventListener('click', handleItemCardClick);
        itemsList.addEventListener('input', calculateTotals);
        savePdfBtn.addEventListener('click', handleGeneratePdfClick);
        backToMainBtn.addEventListener('click', showMainPage);
        qrCodeImageInput.addEventListener('change', handleQRImageSelect);
    });

    function generateDocumentNumber() {
        const now = new Date();
        const thaiYear = now.getFullYear() + 543;
        const year2 = (thaiYear % 100).toString().padStart(2, '0');
        const month2 = (now.getMonth() + 1).toString().padStart(2, '0');
        const random8 = Math.floor(Math.random() * 1e8).toString().padStart(8, '0');
        return `LTK${year2}${month2}${random8}`;
    }

    function showMainPage() {
        formContainer.style.display = 'none';
        initialPage.style.display = 'block';
        document.getElementById('customer-name').value = '';
        document.getElementById('customer-address').value = '';
        document.getElementById('customer-tax-id').value = '';
        document.getElementById('document-number').value = '';
        itemsList.innerHTML = '';
        qrCodeImageInput.value = '';
        qrPreview.style.display = 'none';
        qrPreviewImg.style.backgroundImage = 'none';
        selectedQRImage = null;
        validationError.style.display = 'none';
        calculateTotals();
    }

    function formatCurrency(num) {
        return isNaN(num) ? '0.00' : num.toLocaleString('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }

    function handleQRImageSelect(event) {
        const file = event.target.files[0];
        if (file) {
            if (file.size > 5 * 1024 * 1024) {
                alert('‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 5MB');
                event.target.value = '';
                return;
            }
            const reader = new FileReader();
            reader.onload = (e) => {
                selectedQRImage = e.target.result;
                qrPreviewImg.style.backgroundImage = `url('${selectedQRImage}')`;
                qrPreview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        } else {
            selectedQRImage = null;
            qrPreviewImg.style.backgroundImage = 'none';
            qrPreview.style.display = 'none';
        }
    }

    function showForm(type) {
        docType = type;
        docTitle.textContent = type;
        initialPage.style.display = 'none';
        formContainer.style.display = 'block';
        window.scrollTo(0, 0);
        if (itemsList.children.length === 0) {
            addItemCard();
        }
        document.getElementById('document-number').value = generateDocumentNumber();
    }

    function addItemCard() {
        const card = document.createElement('div');
        card.className = 'item-card';
        card.innerHTML = `<div class="item-card-row"><label>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label><input type="text" class="item-name" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤"></div><div class="item-card-row"><div><label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</label><input type="number" class="item-qty" value="1" min="0" step="any"></div><div><label></label><select class="item-unit"><option>‡∏ñ‡∏∏‡∏á</option><option>‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö</option><option>‡∏ä‡∏¥‡πâ‡∏ô</option><option>‡∏≠‡∏±‡∏ô</option><option>‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°</option><option>‡∏ï‡∏±‡∏ô</option></select></div><div><label>‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</label><input type="number" class="item-price" placeholder="0.00" min="0" step="any"></div><div><label>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (‡∏ö‡∏≤‡∏ó)</label><input type="number" class="item-discount-baht" placeholder="0.00" min="0" step="any"></div></div><div class="item-card-row item-card-total-row"><label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°</label><span class="item-total">0.00</span><button type="button" class="delete-btn">‡∏•‡∏ö</button></div>`;
        itemsList.appendChild(card);
        calculateTotals();
    }

    function handleItemCardClick(event) {
        if (event.target.classList.contains('delete-btn')) {
            event.target.closest('.item-card').remove();
            calculateTotals();
        }
    }

    function calculateTotals() {
        let subtotal = 0;
        let itemCount = 0;
        document.querySelectorAll('.item-card').forEach(card => {
            const qty = parseFloat(card.querySelector('.item-qty').value) || 0;
            const price = parseFloat(card.querySelector('.item-price').value) || 0;
            const discountBaht = parseFloat(card.querySelector('.item-discount-baht').value) || 0;
            const rowTotal = (qty * price) - discountBaht;
            card.querySelector('.item-total').textContent = formatCurrency(rowTotal);
            subtotal += rowTotal;
            itemCount++;
        });
        grandTotalNumber = subtotal;
        document.getElementById('summary-subtotal').textContent = formatCurrency(subtotal);
        document.getElementById('summary-item-count').textContent = itemCount;
        document.getElementById('summary-grand-total').textContent = formatCurrency(grandTotalNumber);
    }

    async function compressImage(base64, maxSize = 300) {
        return new Promise((resolve) => {
            const img = new Image();
            img.onload = function() {
                let w = img.width, h = img.height;
                if (w > maxSize || h > maxSize) {
                    if (w > h) { h = Math.round(h * (maxSize / w)); w = maxSize; } 
                    else { w = Math.round(w * (maxSize / h)); h = maxSize; }
                }
                const canvas = document.createElement('canvas');
                canvas.width = w; canvas.height = h;
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = '#fff';
                ctx.fillRect(0, 0, w, h);
                ctx.drawImage(img, 0, 0, w, h);
                resolve(canvas.toDataURL('image/jpeg', 0.7));
            };
            img.src = base64;
        });
    }

    function handleGeneratePdfClick() {
        validationError.style.display = 'none';
        validationError.textContent = '';
        let errors = [];
        if (!selectedLogo) {
            errors.push('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏Ç‡∏≠‡∏á‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡πÑ‡∏î‡πâ');
        }
        if (!selectedQRImage) {
            errors.push('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î QR Code');
        }
        if (errors.length > 0) {
            validationError.innerHTML = errors.join('<br>');
            validationError.style.display = 'block';
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
            return;
        }
        generatePDF();
    }

    async function generatePDF() {
        if (savePdfBtn.disabled) return;
        savePdfBtn.disabled = true;
        savePdfBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á...';
        backToMainBtn.disabled = true;

        const pdfTemplate = document.getElementById('pdf-template');
        let compressedQR = selectedQRImage ? await compressImage(selectedQRImage, 300) : null;
        
        // Populate PDF with data
        document.getElementById('pdf-doc-title-render').textContent = docType;
        document.getElementById('pdf-doc-date').textContent = new Date().toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' });
        document.getElementById('pdf-document-number').textContent = document.getElementById('document-number').value || '-';
        document.getElementById('pdf-customer-name').textContent = document.getElementById('customer-name').value || '-';
        document.getElementById('pdf-customer-address').innerHTML = document.getElementById('customer-address').value.replace(/\n/g, '<br>') || '-';
        document.getElementById('pdf-customer-tax-id').textContent = document.getElementById('customer-tax-id').value || '-';
        
        document.getElementById('pdf-qr-code-img').style.backgroundImage = compressedQR ? `url('${compressedQR}')` : 'none';
        document.getElementById('pdf-logo-img').src = selectedLogo || '';

        const pdfItemsTbody = document.getElementById('pdf-items-tbody');
        pdfItemsTbody.innerHTML = '';
        document.querySelectorAll('.item-card').forEach(card => {
            const newRow = pdfItemsTbody.insertRow();
            const qty = parseFloat(card.querySelector('.item-qty').value) || 0;
            const price = parseFloat(card.querySelector('.item-price').value) || 0;
            const discountBaht = parseFloat(card.querySelector('.item-discount-baht').value) || 0;
            const rowTotal = (qty * price) - discountBaht;
            newRow.innerHTML = `
                <td>${card.querySelector('.item-name').value||'-'}</td>
                <td class="text-right">${formatCurrency(qty)}</td>
                <td>${card.querySelector('.item-unit').value||'-'}</td>
                <td class="text-right">${formatCurrency(price)}</td>
                <td class="text-right">${formatCurrency(discountBaht)}</td>
                <td class="text-right">${formatCurrency(rowTotal)}</td>`;
        });
        
        document.getElementById('pdf-summary-tfoot').innerHTML = `
            <tr><td>‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</td><td class="text-right">${document.getElementById('summary-subtotal').textContent}</td></tr>
            <tr class="grand-total"><td>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</td><td class="text-right">${document.getElementById('summary-grand-total').textContent}</td></tr>`;

        try {
            await new Promise(resolve => setTimeout(resolve, 300));
            const canvas = await html2canvas(pdfTemplate, { scale: 3, useCORS: true, allowTaint: true });
            const imgData = canvas.toDataURL('image/png');
            const pdf = new jsPDF({ orientation: 'p', unit: 'mm', format: 'a4' });
            const pdfWidth = pdf.internal.pageSize.getWidth();
            const pdfHeight = pdf.internal.pageSize.getHeight();
            pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
            
            const pdfBlob = pdf.output('blob');
            const docNumber = document.getElementById('document-number').value || 'doc';
            const fileName = `${docType.replace(/[\/ ]/g, '_')}_${docNumber}.pdf`;
            
            const formData = new FormData();
            formData.append('chat_id', TELEGRAM_CHAT_ID);
            formData.append('document', pdfBlob, fileName);
            formData.append('caption', `‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£: ${docType}\n‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà: ${docNumber}\n‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${new Date().toLocaleDateString('th-TH',{year:'numeric',month:'long',day:'numeric'})}\n‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${document.getElementById('customer-name').value||'-'}\n‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ${formatCurrency(grandTotalNumber)} ‡∏ö‡∏≤‡∏ó`);

            const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendDocument`, { method: 'POST', body: formData });
            
            if (response.ok) {
                alert('‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á PDF ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Telegram ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!');
                showMainPage();
            } else {
                const result = await response.json();
                console.error('Failed to send PDF to Telegram:', result);
                alert(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏õ Telegram: ${result.description}\n\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏•‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏ó‡∏ô`);
                pdf.save(fileName);
            }
        } catch (error) {
            console.error("Error during PDF generation:", error);
            alert(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á PDF: ${error.message}`);
        } finally {
            savePdfBtn.disabled = false;
            savePdfBtn.textContent = '‡∏™‡∏£‡πâ‡∏≤‡∏á PDF ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á Telegram';
            backToMainBtn.disabled = false;
        }
    }
})();
</script>

</body>
</html>
